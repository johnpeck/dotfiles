#!/bin/bash

DOTFILES=`dirname "$0"`
BASE=$DOTFILES/../dotfiles

genlinks() {
  for FILE in `ls -A $BASE`
  do
    FILEPATH=$BASE/$FILE
    DEST=$HOME/$FILE
    OLD=$HOME/old.dotfiles
    if [ -a  "$DEST" ]
    then
      if [ ! -d $OLD ]
      then
        mkdir -p $OLD
      fi
      DEST_REAL=$DEST
      if [ -h "$DEST" ]
      then
        DEST_REAL=`readlink $DEST`
      fi
      mv $DEST_REAL $OLD
    fi
    ln -s $FILEPATH $DEST
  done
}

case "$1" in

  "add")
    FILE=$2
    # for FILE in `ls "$FILES"`
    FILENAME=`basename $FILE`
    mv $FILE $BASE
    # check if file already exists or if its already a sim link
      # if already exists, move to old folder
      # if sim link, follow it
    ln -s $BASE/$FILENAME $HOME/$FILENAME
    cd $BASE
    git add $FILENAME
    cd ..
    git commit -m "adding $FILENAME"
    git push origin master
  ;;

  "save")
    cd $BASE
    git commit -am "saving `date`"
    git push origin master
  ;;

  "update")
    cd $DOTFILES
    git pull
    # add sim link to new files, check existent files to see if they are already there (if same, keep, otherwise move to old)
  ;;

  "upgrade")
    cd $DOTFILES
    git fetch dotfiles
    git merge dotfiles/master
  ;;

  "genlinks")
    genlinks
  ;;

  *)
    echo "Unknown command!"
  ;;

esac

